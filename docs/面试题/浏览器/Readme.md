# 浏览器相关面试题

## 兼容性问题

1. IOS 识别时间格式限制：只能识别 YYYY/MM/DD 不能识别 YYYY-MM-DD
2. IOS 部分版本不支持 border-style 的 dashed dotted，需要使用 background-image 来实现虚线点线的效果
3. IOS 低版本使用 padding 撑起盒子高度时，border 会被裁减一部分，需要使用 height 属性指定高度
4. 输入汉字时，IOS 会在 input 输入框内显示拼音，并且把拼音也算作内容的一部分，当输入框有长度限制时，就会导致计算出错；需要使用 compositionStart、compositionEnd 重新调整计算逻辑
5. 部分安卓设备的按钮垂直居中文字会有偏上的情况

## 错误监控

### 错误类型

- js 执行错误
  - `SyntaxError` 解析时发生语法错误
  - `TypeError` 值不是所期待的类型
  - `ReferenceError` 引用未声明的变量
  - `RangeError` 当一个值不在其所允许的范围或者集合中
- 网络错误
  - `ResourceError` 资源加载错误
  - `HttpError` Http 请求错误

### 搜集错误

- `try catch` 能捕获同步代码常规运行时错误，语法错误和异步错误不行
- `window.onerror = function handler(){}` 可以捕获常规运行时错误和异步错误，不能捕获资源加载错误和语法错误
- `window.addEventListener('error', handler, true)` 可以捕获资源加载错误
- `promise.catch(handler)` 捕获 promise reject 的错误
- `window.addEventListener('unhandledrejection', handler)` 可以捕获没有被 catch 处理的 promise 错误

### 上报错误

使用 `new Image()` 加载一个 1\*1 的透明 gif 图片的方式上报错误

- 为什么？
  - 防止跨域（排除接口上报的方式）
  - 不影响页面渲染（排除 css，js 文件的方式）
  - gif 图片更小（排除 png，jpg），透明的图片也不会影响页面展示

### 其他

后端收集好错误信息后，还需要一个后台管理系统能把信息展示出来，通常都是使用图表的方式，分门别类的展示。

## 安全策略

### 跨站脚本攻击（XSS）

Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。
为了和 CSS 区分，这里把攻击的第一个字母改成了 X，于是叫做 XSS。

- 对用户的输入进行过滤
- 渲染不安全的数据时尽量使用 innerText、v-text，或者转译后再渲染到页面

### 跨站请求伪造（CSRF）

CSRF（Cross-site request forgery）跨站请求伪造：攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证（cookie），绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的。

- 同源检测：禁止第三方域名向服务器发起请求
- CSRF Token：由服务端返回一个 token 植入到页面中，后续请求会携带 token，然后校验 token 的正确性
- cookie 设置 SameSite 为 strict：即严格模式，表示这个 cookie 不会作为第三方网站的 cookie

### 点击劫持（ClickJacking）

点击劫持（Clickjacking）是一种通过视觉欺骗的手段来达到攻击目的手段。往往是攻击者将目标网站通过 iframe 嵌入到自己的网页中，通过 opacity 等手段设置 iframe 为透明的，使得肉眼不可见，这样一来当用户在攻击者的网站中操作的时候，比如点击某个按钮（这个按钮的顶层其实是 iframe），从而实现目标网站被点击劫持。

### HTTP 严格传输安全（HSTS）

HTTP 严格传输安全(HSTS)是一种安全功能，web 服务器通过它来告诉浏览器仅用 HTTPS 来与之通讯，而不是使用 HTTP。

### CDN 劫持

网络上有很多黑客为了让用户能够登录自己开发的钓鱼网站，都会通过对 CDN 进行劫持的方法，让用户自动转入自己开发的网站。而很多用户却往往无法察觉到自己已经被劫持。其实验证被劫持的方法，就是输入任何网址看看所打开的网页是否和自己输入的网址一致

### 内容安全策略（CSP）

内容安全策略（Content Security Policy）简称 CSP，通过它可以明确的告诉客户端浏览器当前页面的哪些外部资源可以被加载执行，而哪些又是不可以的。

防 XSS 等攻击的利器。CSP 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。CSP 大大增强了网页的安全性。攻击者即使发现了漏洞，也没法注入脚本，除非还控制了一台列入了白名单的可信主机。

### 安全沙箱（Sandbox）

多进程的浏览器架构将主要分为两块：浏览器内核和渲染内核。而安全沙箱能限制了渲染进程对操作系统资源的访问和修改，同时渲染进程内部也没有读写操作系统的能力，而这些都是在浏览器内核中一一实现了，包括持久存储、网络访问和用户交互等一系列直接与操作系统交互的功能。浏览器内核和渲染内核各自职责分明，当他们需要进行数据传输的时候会通过 IPC 进行

而渲染进程的工作是进行 HTML、CSS 的解析，JavaScript 的执行等，而这部分内容是直接暴露给用户的，所以也是最容易被黑客利用攻击的地方，如果黑客攻击了这里就有可能获取到渲染进程的权限，进而威胁到操作系统。所以需要一道墙用来把不可信任的代码运行在一定的环境中，限制不可信代码访问隔离区之外的资源，而这道墙就是浏览器的安全沙箱。

安全沙箱的存在是为了保护客户端操作系统免受黑客攻击，但是阻止不了 XSS 和 CSRF。

### Iframe

iframe 在给我们的页面带来更多丰富的内容和能力的同时，也带来了不少的安全隐患。因为 iframe 中的内容是由第三方来提供的，默认情况下他们不受我们的控制，他们可以在 iframe 中运行 JavaScirpt 脚本、Flash 插件、弹出对话框等等，这可能会破坏前端用户体验。
